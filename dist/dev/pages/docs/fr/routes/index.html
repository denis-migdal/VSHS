<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf8"/>
        <title>VSHS</title>
        <!--
        <meta name="theme-color" media="(prefers-color-scheme: light)" content="cyan" />
        <meta name="theme-color" media="(prefers-color-scheme: dark)" content="black" />
        -->
        <meta name="color-scheme" content="dark light">
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link   href="./index.css"  rel="stylesheet" blocking="render">
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.13.0/brython.min.js"></script>
        <script  src="./index.js"  type="module"     blocking="render" async></script>
    </head>
    <body>
        <main>

<h1 id="d√©finir-une-route">D√©finir une route</h1>
<h2 id="param√®tres-de-routes">Param√®tres de routes</h2>
<p>Il est fr√©quent de traiter un ensemble d&#39;URL suivant le m√™me format (e.g. <js-code>/produits/<var>$ID</var></js-code> ) par le m√™me <em>request handler</em> :</p>
<ul>
<li><code>/produits/1</code> ;</li>
<li><code>/produits/2</code> ;</li>
<li><code>/produits/3</code> ;</li>
<li>etc.</li>
</ul>
<p><js-code><var>$ID</var></js-code> est alors un <strong>param√®tre de route</strong> et sera indiqu√© par son nom entre accolades, i.e. <js-code><var>{ID}</var></js-code>.<br/>
Il suffit ainsi de cr√©er un fichier <js-code>/produits/{ID}/GET.ts</js-code> pour d√©finir un <em>request handler</em> associ√© √† cet ensemble d&#39;URL.</p>
<p>Le second param√®tre des requests handlers contient, entres autres :</p>
<ul>
<li><code>path</code> : la route trait√©e ;</li>
<li><code>vars</code> : les param√®tres de routes.</li>
</ul>
<vshs-playground name="echo (vars)" show="index.code,output">
</vshs-playground>
<div style="text-align:right"><a href="../../../playground/?example=echo (vars)"><i>Tester l'exemple dans le bac √† sable</i></a></div>

<h2 id="route-par-d√©faut">Route par d√©faut</h2>
<p>En cas d&#39;erreur non-trait√©e, ou de route non-trouv√©e, la requ√™te sera redirig√©e vers la <strong>route par d√©faut</strong> <code>/default/GET</code>.</p>
<p>üí° Vous pouvez ainsi d√©finir un <em>request handler</em> par d√©faut via le fichier <code>$ROUTES/default/GET.*</code>.</p>
<p>En cas d&#39;erreurs, ce <em>request handler</em> sera appel√© avec des propri√©t√©s additionnelles pour son second argument :</p>
<ul>
<li><code>.error</code> : l&#39;erreur re√ßue.</li>
<li><code>.route</code> : le second argument du premier <em>request handler</em> appel√©.</li>
</ul>
<p>üí° Vous pouvez red√©finir la route par d√©faut via les options suivantes :</p>
<style>
table, th, td {
  border: 1px solid grey;
  border-collapse: collapse;
}

tbody th {
    text-align: left;
}

th,td {
  padding: 5px;
}
</style>
<table>
    <thead>
        <tr><th></th><th>CLI</th><th>TS</th></tr>
    </thead>
    <tbody>
        <tr><th>Tous</th><td><js-code>--default</js-code></td><td><js-code>default</js-code></td></tr>
        <tr><th>Route non trouv√©e</th><td><js-code>--not_found</js-code></td><td><js-code>not_found</js-code></td></tr>
        <tr><th>Erreur non-captur√©e</th><td><js-code>--internal_error</js-code></td><td><js-code>internal_error</js-code></td></tr>
    </tbody>
</table>

<h2 id="assets">Assets</h2>
<p>Les assets sont des fichiers statiques lus par le serveur puis renvoy√©s comme r√©ponse.</p>
<p>VSHS offre quelques helpers pour cela :</p>
<ul>
<li><code>fetchAsset(path)</code> : retourne un <code>ReadableStream</code> sur le fichier (lance une exception si n&#39;existe pas).</li>
<li><code>getMime(path)</code> : retourne le type-mime √† partir du nom de fichier.</li>
</ul>
<p>Pa d√©fault, si une route n&#39;est pas trouv√©e ( et si le chemin commence par la valeur indiqu√©e par <code>assets_prefix</code>), VSHS servira, s&#39;il existe, le fichier correspond.</p>
<table>
    <thead>
        <tr><th></th><th>CLI</th><th>TS</th></tr>
    </thead>
    <tbody>
        <tr><th>Dossier contenant les assets</th><td><js-code>--assets</js-code></td><td><js-code>assets</js-code></td></tr>
        <tr><th>Pr√©fixe du chemin</th><td><js-code>--assets_prefix</js-code></td><td><js-code>assets_prefix</js-code></td></tr>
    </tbody>
</table>

</main>
    </body>
</html>